#########
# Author:        ab6
# Maintainer:    $Author: rmp $
# Last Modified: $Date: 2007/03/14 13:16:04 $
# Id:            $Id: yourgenome.pm,v 6.2 2007/03/14 13:16:04 rmp Exp $
# Source:        $Source: /repos/cvs/webcore/SHARED_docs/lib/core/SiteDecor/yourgenome.pm,v $
# $HeadURL$
#
# decoration for (www|dev).yourgenome.org
#
package SiteDecor::yourgenome;
use strict;
use warnings;
use Sys::Hostname;
use base qw(SiteDecor);

our $VERSION = do { my @r = (q$Revision: 6.2 $ =~ /\d+/mxg); sprintf '%d.'.'%03d' x $#r, @r };

sub init_defaults {
  my $self = shift;
  my $def  = {
	      'redirect_delay' => 5,
	      'bannercase'     => 'ucfirst',
	      'author'         => 'webmaster',
	      'decor'          => 'full',
	     };
  return $self->merge($def);
}

sub html_headers {
  my $self   = shift;
  my $title  = $self->title()  || 'YourGenome.org';
  my $jsfile = $self->jsfile() || [];

  my $html_headers = qq(<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb">
  <head>
    <title>$title</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="author"  content="Genome Research Limited" />
    <meta name="version" content="$VERSION" />
    <meta name="description" content="The YourGenome.org - http://www.yourgenome.org - website holds information on the public awareness of genome science produced by the Wellcome Trust Sanger Institute. The definitive source for information, news and discussion in the field of genome science, www.yourgenome.org answers questions like What is the Human Genome? Why research it? How can it be used? Who owns it?" />
    <meta name="keywords" content="wellcome trust sanger institute, genes, proteins, dna, rna, bioinformatics, human genome project" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <style type="text/css" media="all">
      \@import url(/css/yg.css);
    </style>
    <style type="text/css" media="print">
      \@import url(/css/printer-styles.css);
    </style>
    <style type="text/css" media="screen">
      \@import url(/css/screen-styles.css);
    </style>);

    if (@{$jsfile}) {
      $html_headers .= join "\n", map { qq(<script type="text/javascript" src="$_" ></script>\n) } @{$jsfile};
    }

  my @navigator   = $self->sidebar_entries('navigator');
  my $nav_counter = 1;

  $html_headers .= qq(</head>
  <body>
    <div id="header">
      <div id="image1"><img src="/gfx/1.png" alt="" />
      </div>
      <ul id="headlinks">
@{[map { qq(<li id="link@{[$nav_counter++]}">$_</li>); } @navigator]}
      </ul>
      <div id="image2"><img src="/gfx/2-1.png" alt="" /></div>
      <div id="banner"><a href="/"><img src="/gfx/yg_banner920.jpg" alt="Banner" title="YourGenome.org Home" /></a></div>
      <div id="BreadCrumbBar"></div>
      <div id="headwherebar"></div>
    </div>\n);

  return $html_headers;
}

sub site_footers {
  my $self    = shift;
  my $lastmod = q();
  my $req_uri = $ENV{'REQUEST_URI'} || q();

  if($ENV{'LAST_MODIFIED'}) {
    $lastmod = qq(Last Modified $ENV{'LAST_MODIFIED'});

  } else {
    #########
    # Look for the request_uri document
    #
    my ($fn) = "$ENV{'DOCUMENT_ROOT'}/$req_uri" =~ m|([a-z\d\./_]+)|mxi;

    #########
    # If that doesn't exist try the script_filename
    #
    if($fn && !-e $fn) {
      ($fn) = $ENV{'SCRIPT_FILENAME'}||q() =~ m|([a-z\d\./_]+)|mxi;
    }

    if($fn && -e $fn) {
      my ($mtime)     = (stat $fn)[9];
      my $scriptstamp = localtime $mtime;
      if($scriptstamp) {
	$lastmod = qq(Last Modified $scriptstamp);
      }
    }
  }

  return qq(
    </div><!-- end main_content -->
    <div id="footer">
      <ul id="footlinks">
        <li id="foot1"><a href="mailto:webmaster\@yourgenome.org?Subject=YourGenome%20Feedback">webmaster\@yourgenome.org</a></li>
        <li id="foot2"><a href="/notices/disclaimer.shtml">Conditions of Use</a></li>
        <li id="foot3"><a href="/notices/copyright.shtml">Copyright</a></li>
        <li id="foot4"></li>
      </ul>
      <div id="host"><a href="http://www.sanger.ac.uk/"><img src="/gfx/wtsi.png" alt="WTSI" title="Hosted by the Wellcome Trust Sanger Institute" /></a></div>
    </div>
  </body>
</html>\n);
}

1;
